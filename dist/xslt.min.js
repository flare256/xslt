(function(){var root,factory,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};root=this,factory=function(root){var $xslt,activeXSupported,buildElementString,cleanRootNamespaces,cleanupXmlNodes,collapseEmptyElements,createDomDoc,createXSLTemplate,defaults,docToStr,expandCollapsedElements,extractNamespaces,getAttrVal,getAttributes,getHeader,getHeaderEncoding,getHeaderStandalone,hasXmlHeader,isXml,loadOptions,manualCreateElement,needsHeader,newDocument,prependHeader,regex,strToDoc,stripAllNamespaces,stripDuplicateAttributes,stripHeader,stripNamespacedNamespace,stripNullNamespaces,tryCreateActiveX,xmlHeader;return regex={xmlNode:function(){return/<([a-z_][a-z_0-9:\.\-]*\b)\s*(?:\/(?!>)|[^>\/])*(\/?)>/i},xmlLike:function(){return/^\s*</},xmlHeader:function(){return/^\s*<\?xml\b[^<]+/i},namespaces:function(){return/\bxmlns(?::([a-z0-9:\-]+))?\s*=\s*"([^"]*)"/gi}},isXml=function(str){return regex.xmlLike().test(str)},hasXmlHeader=function(str){return regex.xmlHeader().test(str)},needsHeader=function(str){return isXml(str)&&!hasXmlHeader(str)},xmlHeader=function(encoding,standalone){var str;return str='<?xml version="1.0" ',null!=encoding&&(str+='encoding="'+encoding+'" '),null!=standalone&&(str+='standalone="'+standalone+'" '),str+="?>"},prependHeader=function(str,encoding,standalone){return xmlHeader(encoding,standalone)+str},stripHeader=function(str){return null!=str?str.replace(regex.xmlHeader(),""):void 0},getHeader=function(str){var match,ref;return(null!=(match=null!=str?str.match(regex.xmlHeader()):void 0)?match.length:void 0)&&(null!=(ref=match[0])&&"function"==typeof ref.trim?ref.trim():void 0)||null},getAttrVal=function(node,attrName){var match;return 1<(null!=(match=new RegExp("\\b"+attrName+'\\s*=\\s*"([^"]*)"',"g").exec(node))?match.length:void 0)&&match[1]||null},getHeaderEncoding=function(str){return getAttrVal(getHeader(str),"encoding")},getHeaderStandalone=function(str){return getAttrVal(getHeader(str),"standalone")},activeXSupported="undefined"!=typeof ActiveXObject&&null!==ActiveXObject||"ActiveXObject"in window,tryCreateActiveX=function(){var i,id,len,objIds;if(objIds=1<=arguments.length?slice.call(arguments,0):[],!activeXSupported)return null;for(i=0,len=objIds.length;i<len;i++){id=objIds[i];try{return new ActiveXObject(id)}catch(undefined){}}return null},createDomDoc=function(){var d;if(null!=(d=tryCreateActiveX.apply(null,["Msxml2.FreeThreadedDOMDocument.6.0","Msxml2.FreeThreadedDOMDocument.3.0","Msxml2.FreeThreadedDOMDocument","Microsoft.XMLDOM","Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument"])))for(d.async=!1;4!==d.readyState;);return d},createXSLTemplate=function(){return tryCreateActiveX.apply(null,["Msxml2.XSLTemplate.6.0","Msxml2.XSLTemplate"])},manualCreateElement=function(){var res,xml;return(xml=document.createElement("xml")).src=xmlHeader(),document.body.appendChild(xml),res=xml.XMLDocument,document.body.removeChild(xml),res},newDocument=function(){var d,ref;return(d=null)==d&&(d=createDomDoc()),"undefined"!=typeof DOMParser&&null!==DOMParser||(null==d&&(d=manualCreateElement()),null==d&&(d=null!=(ref=document.implementation)&&"function"==typeof ref.createDocument?ref.createDocument("","test",null):void 0)),d},strToDoc=function(str){var d,ref,ref1,ref2,ref3;if("object"==typeof str)return str;if("string"!=typeof str||!isXml(str))return null;if(needsHeader(str)&&(str=prependHeader(str)),null!=(d=newDocument())&&"loadXML"in d){if(d.loadXML(str),null==d.documentElement||0!==(null!=(ref=d.parseError)?ref.errorCode:void 0))throw new Error("loadXML error: "+d.parseError)}else if(null!=d&&"load"in d)d.load(str);else if("undefined"!=typeof DOMParser&&null!==DOMParser&&(0<(null!=(d=null!=(ref1=new DOMParser)&&"function"==typeof ref1.parseFromString?ref1.parseFromString(str,"text/xml"):void 0)&&"function"==typeof d.getElementsByTagName&&null!=(ref2=d.getElementsByTagName("parsererror"))?ref2.length:void 0)||"parsererror"===(null!=d&&null!=(ref3=d.documentElement)?ref3.nodeName:void 0)))throw new Error("Failed to load document from string:\r\n"+d.documentElement.textContent);return d},docToStr=function(doc){var ref,xml;return null==doc?null:(0<=(null!=(xml="string"==typeof doc?doc:null!=(null!=doc?doc.xml:void 0)?doc.xml:"undefined"!=typeof XMLSerializer&&null!==XMLSerializer?null!=(ref=new XMLSerializer)&&"function"==typeof ref.serializeToString?ref.serializeToString(doc):void 0:null)&&"function"==typeof xml.indexOf?xml.indexOf("<transformiix::result"):void 0)&&(xml=xml.substring(xml.indexOf(">")+1,xml.lastIndexOf("<"))),xml)},getAttributes=function(node,excludeFn){var attrRegex,attrs,innerA,innerB,name,outer,parts,val;for(attrRegex=/\s([a-z0-9:\-]+)\s*=\s*("([^"]*)"|'([^']*)')/gi,attrs={};parts=attrRegex.exec(node);)parts[0],name=parts[1],outer=parts[2],innerA=parts[3],innerB=parts[4],val={outer:outer,inner:innerA||innerB},("function"==typeof excludeFn?excludeFn(name,val):void 0)||(attrs[name]=val);return attrs},buildElementString=function(nodeName,attrs,closeTag){var elStr,name;for(name in null==attrs&&(attrs={}),null==closeTag&&(closeTag=""),elStr="<"+nodeName,attrs)elStr+=" "+name+"="+attrs[name].outer;return elStr+=closeTag+">"},cleanRootNamespaces=function(node,nodeName,closeTag,opt){var attName,attrs,name,ns,ref,uri,val;for(ns in attrs=getAttributes(node,function(name,val){var ref;return/^xmlns/.test(name)&&(ref=val.inner,0<=indexOf.call(opt.excludedNamespaceUris,ref))}),ref=opt.includeNamespaces)uri=ref[ns],indexOf.call(function(){var results;for(name in results=[],attrs)val=attrs[name],results.push(val.inner);return results}(),uri)<0&&(attName="xmlns",ns.length&&(attName+=":"+ns),attrs[attName]={outer:'"'+uri+'"',inner:uri});return buildElementString(nodeName,attrs,closeTag)},stripDuplicateAttributes=function(node,nodeName,closeTag,blacklist){var attrs;return null==blacklist&&(blacklist=[]),attrs=getAttributes(node,function(name,val){var ref;return ref=val.inner,0<=indexOf.call(blacklist,ref)}),buildElementString(nodeName,attrs,closeTag)},stripNullNamespaces=function(node){return node.replace(/xmlns\s*=\s*""/gi,"")},stripAllNamespaces=function(node){return node.replace(regex.namespaces(),"")},defaults={fullDocument:!(expandCollapsedElements=function(xml){return null!=xml?xml.replace(/<(([a-z_][a-z_0-9:\.\-]*\b)\s*(?:\/(?!>)|[^>\/])*)\/>/gi,function(all,element,name){return"<"+element+"></"+name+">"}):void 0}),cleanup:!0,xmlHeaderInOutput:!0,normalizeHeader:!0,encoding:"UTF-8",preserveEncoding:!(collapseEmptyElements=function(xml){return null!=xml?xml.replace(/<(([a-z_][a-z_0-9:\.\-]*\b)\s*(?:\/(?!>)|[^>\/])*)><\/\2>/gi,function(all,element){return"<"+element+"/>"}):void 0}),collapseEmptyElements:!0,expandCollapsedElements:!(cleanupXmlNodes=function(xml,opt){var isRootNode,namespaceBlacklist;return namespaceBlacklist=[],isRootNode=!0,null!=xml?xml.replace(new RegExp(regex.xmlNode().source,"gi"),function(node,nodeName,closeTag){var i,len,name,ref,rootNamespaces,uri,val;if(opt.removeNamespacedNamespace&&(node=stripNamespacedNamespace(node)),opt.removeNullNamespace&&(node=stripNullNamespaces(node)),opt.removeAllNamespaces&&(node=stripAllNamespaces(node)),isRootNode)for(isRootNode=!1,node=cleanRootNamespaces(node,nodeName,closeTag,opt),rootNamespaces=getAttributes(node,function(name){return!/^xmlns/.test(name)}),namespaceBlacklist=function(){var results;for(name in results=[],rootNamespaces)val=rootNamespaces[name],results.push(val.inner);return results}(),i=0,len=(ref=opt.excludedNamespaceUris).length;i<len;i++)uri=ref[i],namespaceBlacklist.push(uri);else(opt.removeDupAttrs||opt.removeDupNamespace)&&(node=stripDuplicateAttributes(node,nodeName,closeTag,namespaceBlacklist));return node}):void 0}),removeDupNamespace:!0,removeDupAttrs:!0,removeNullNamespace:!0,removeAllNamespaces:!(extractNamespaces=function(xml,excludedUris){var ns;return null==excludedUris&&(excludedUris=[]),ns={},{xml:xml=null!=xml?xml.replace(regex.namespaces(),function(orig,key,uri){return null==key&&(key=""),null!=ns[key]&&ns[key]!==uri?orig:(0<=indexOf.call(excludedUris,uri)||(ns[key]=uri),"")}):void 0,ns:ns}}),removeNamespacedNamespace:!0,includeNamespaces:{},excludedNamespaceUris:[],moveNamespacesToRoot:!(stripNamespacedNamespace=function(node){var i,len,num,nums;for(nums=[],node=node.replace(/xmlns:NS([0-9]+)=""/gi,function(match,num){return nums.push(num),""}),i=0,len=nums.length;i<len;i++)num=nums[i],node=node.replace(new RegExp("NS"+num+":xmlns:","g"),"xmlns:");return node})},loadOptions=function(options){var opt,p;for(p in opt={},defaults)opt[p]=defaults[p];if(null!=options)for(p in options)opt[p]=options[p];return opt},($xslt=function(xmlStr,xsltStr,options){var opt,outStr,processor,ref,trans,xmlDoc,xslProc,xslt,xsltDoc;if(opt=loadOptions(options),null==(xmlDoc=strToDoc(xmlStr)))throw new Error("Failed to load the XML document");if(null==(xsltDoc=strToDoc(xsltStr)))throw new Error("Failed to load the XSLT document");return"undefined"!=typeof XSLTProcessor&&null!==XSLTProcessor&&null!=("undefined"!=typeof document&&null!==document&&null!=(ref=document.implementation)?ref.createDocument:void 0)?((processor=new XSLTProcessor).importStylesheet(xsltDoc),trans=opt.fullDocument?processor.transformToDocument(xmlDoc):processor.transformToFragment(xmlDoc,document)):"transformNode"in xmlDoc?trans=xmlDoc.transformNode(xsltDoc):activeXSupported&&((xslt=createXSLTemplate()).stylesheet=xsltDoc,(xslProc=xslt.createProcessor()).input=xmlDoc,xslProc.transform(),trans=xslProc.output),outStr=docToStr(trans),opt.preserveEncoding&&(opt.encoding=getHeaderEncoding(outStr)||getHeaderEncoding(xmlStr)||opt.encoding),opt.cleanup&&(outStr=$xslt.cleanup(outStr,opt)),outStr}).cleanup=function(outStr,options){var key,ns,opt,ref,ref1,standalone,uri;if((opt=loadOptions(options)).cleanup){if(opt.preserveEncoding&&(opt.encoding=getHeaderEncoding(outStr)||opt.encoding),standalone=getHeaderStandalone(outStr),!opt.normalizeHeader&&opt.xmlHeaderInOutput||(outStr=stripHeader(outStr)),opt.xmlHeaderInOutput&&needsHeader(outStr)&&(outStr=prependHeader(outStr,opt.encoding,standalone)),opt.moveNamespacesToRoot){for(key in ns=(ref=extractNamespaces(outStr,opt.excludedNamespaceUris)).ns,outStr=ref.xml,ref1=opt.includeNamespaces)uri=ref1[key],ns[key]=uri;opt.includeNamespaces=ns}return outStr=cleanupXmlNodes(outStr,opt),opt.collapseEmptyElements&&!opt.expandCollapsedElements&&(outStr=collapseEmptyElements(outStr)),opt.expandCollapsedElements&&!opt.collapseEmptyElements&&(outStr=expandCollapsedElements(outStr)),outStr}},$xslt.strToDoc=function(str){return strToDoc(str)},$xslt},"function"==typeof define&&null!=define.amd?define([],function(){return factory()}):"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=factory():null!=root&&(root.xslt=factory())}).call(this);